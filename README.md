# ISOP - 規格対応書類更新AIエージェント

## 概要

ISOPは、ISOやプライバシーマークなどの規格文書の更新を支援するAIエージェントです。既存の規格関連書類と新規格内容を比較し、AIが自動的に書類を更新し、差分レポートを生成します。

## 主な機能

### 🏠 ホーム
- アプリケーションの概要と機能説明
- クイックスタートガイド
- 対応規格の一覧

### 📄 書類アップロード
- **既存書類**: PDF、DOCX、TXT形式の既存規格関連書類をアップロード
- **新規格内容**: PDF、TXT形式の新規格内容をアップロード
- **プレビュー機能**: アップロードしたファイルの内容をプレビュー
- **ファイル情報表示**: ファイルサイズ、形式、アップロード時刻を表示

### 🤖 AI処理
- **処理ステップ表示**: 書類解析、ベクトル化、AI書き換え、差分生成の進捗を可視化
- **AI対話機能**: AIからの質問に回答し、書類更新を支援
- **処理ログ**: 詳細なログ記録と表示

### 📊 差分レポート
- 変更前後の書類の差分を可視化
- マークダウン形式での差分レポート生成
- 新書類と差分レポートのダウンロード機能

### 📦 バッチ処理
- **複数書類一括処理**: 複数の書類を同時に処理
- **処理進捗表示**: 各書類の処理状況をリアルタイム表示
- **結果サマリー**: 処理結果の統計情報を表示
- **一括ダウンロード**: 処理結果を一括でダウンロード

### 📋 テンプレート管理
- **規格別テンプレート**: ISO 27001、ISO 9001、プライバシーマーク等のテンプレート
- **カスタムテンプレート**: 独自のテンプレートを作成・管理
- **テンプレート適用**: プレースホルダーを使用したカスタマイズ
- **テンプレートプレビュー**: テンプレート内容の確認

### ⚙️ 設定
- **API設定**: OpenAI APIキーの設定とモデル選択
- **データベース設定**: ChromaDBパスの設定
- **システム情報**: バージョン情報とシステム状態
- **ログ管理**: ログのエクスポート機能

## 新機能・改善点

### UI/UX改善
- **タブ分け**: 各機能をタブで整理し、使いやすさを向上
- **サイドメニュー**: ナビゲーションをサイドバーに配置
- **プログレスバー**: 処理進捗を視覚的に表示
- **メトリクス表示**: ファイル情報や処理状況を数値で表示

### AI対話機能
- **対話管理**: ユーザーとAIの対話を管理
- **質問生成**: 書類更新に必要な質問を自動生成
- **回答記録**: ユーザーの回答を記録し、書類更新に反映

### ログ機能強化
- **詳細ログ**: 処理の各段階を詳細に記録
- **エラーハンドリング**: エラーの詳細情報を記録
- **ログ表示**: リアルタイムでログを確認
- **ログエクスポート**: JSON/テキスト形式でログをエクスポート

### エラーハンドリング
- **段階的エラー処理**: 各処理段階でのエラーを適切に処理
- **ユーザーフレンドリーなエラーメッセージ**: 技術的詳細を隠し、分かりやすいメッセージを表示
- **処理継続**: エラーが発生しても可能な限り処理を継続

## 対応規格

- ISO 27001（情報セキュリティマネジメント）
- ISO 9001（品質マネジメント）
- プライバシーマーク
- その他の規格対応も可能

## 設定

### 環境変数

アプリケーションは以下の環境変数を使用します：

#### `.env`ファイルを使用する場合
プロジェクトルートに`.env`ファイルを作成し、以下を設定：

```
CHROMA_DB_PATH=./chroma_db
OPENAI_API_KEY=your_openai_api_key
```

#### 環境変数を直接設定する場合
```bash
export CHROMA_DB_PATH=/path/to/chroma_db
export OPENAI_API_KEY=your_openai_api_key
```

### デフォルト設定
- `CHROMA_DB_PATH`が設定されていない場合、デフォルトで`./chroma_db`を使用
- `OPENAI_API_KEY`は必須です

## 使用方法

1. **環境設定**: 必要な環境変数を設定
2. **アプリケーション起動**: `streamlit run app_core/app.py`
3. **書類アップロード**: 既存書類と新規格内容をアップロード
4. **AI処理実行**: AIによる自動書類更新を実行
5. **差分確認**: 生成された差分レポートを確認
6. **結果ダウンロード**: 新書類と差分レポートをダウンロード

## 技術スタック

- **フロントエンド**: Streamlit
- **AI**: OpenAI GPT-4o-mini
- **ベクトルデータベース**: ChromaDB
- **言語**: Python 3.11
- **ログ管理**: カスタムログシステム

## 開発者向け情報

### プロジェクト構造
```
ISOP-main/
├── app_core/           # メインアプリケーション
├── ai_agent/           # AI関連機能
├── document_processor/ # ドキュメント処理
├── services/           # ビジネスロジック
├── utils/              # ユーティリティ
├── tests/              # テスト
└── requirements.txt    # 依存関係
```

### 主要モジュール
- `app_core/app.py`: メインアプリケーション
- `ai_agent/dialog_manager.py`: AI対話管理
- `utils/logger.py`: ログ管理
- `services/document_service.py`: ドキュメント処理サービス

## 今後の展望

- 画像・図表からの情報抽出機能
- 多言語対応の強化
- 規格変更の自動検知と通知
- カスタマイズ可能なルールベース
- バージョン管理と履歴機能
- 専門家によるレビュー機能

